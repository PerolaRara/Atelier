<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Pérola Rara</title>
    
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#ecd5d1">
    
    <!-- Fontes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

    <link rel="icon" href="assets/images/favicon.ico" type="image/x-icon">
    
    <!-- Estilos -->
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/orcamentos.css">
    <link rel="stylesheet" href="assets/css/precificacao.css">

    <!-- Bibliotecas Externas -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

    <!-- Módulos JS -->
    <script type="module" src="assets/js/firebase-config.js"></script> <!-- Garantir ordem -->
    <script type="module" src="assets/js/precificacao-insumos.js"></script> 
    <script type="module" src="assets/js/main.js"></script>
    <script type="module" src="assets/js/orcamentos.js"></script>
    <script type="module" src="assets/js/relatorios.js"></script>
    <script type="module" src="assets/js/precificacao.js"></script>
</head>
<body>

    <!-- 1. TELA DE LOGIN -->
    <section id="auth-screen">
        <div class="auth-container">
            <div class="auth-form">
                <div class="logo-container">
                    <img src="assets/images/logo_perola_rara.png" alt="Logo Pérola Rara" id="logo-login" width="150">
                    <h1 class="login-brand-name">Pérola Rara</h1>
                </div>
                <h2>Acesso ao Portal</h2>
                
                <div class="form-group">
                    <label for="email">Email:</label>
                    <input type="email" id="email" name="email" placeholder="Digite seu email">
                </div>
                <div class="form-group">
                    <label for="password">Senha:</label>
                    <input type="password" id="password" name="password" placeholder="Digite sua senha">
                </div>
                <div class="auth-buttons">
                    <button type="button" id="loginBtn">Entrar</button>
                </div>
                <p id="auth-message" class="auth-message"></p>
            </div>
        </div>
    </section>

    <!-- 2. SPLASH SCREEN (Carregamento) -->
    <section id="splash-screen" style="display: none;">
        <div class="splash-content">
            <img src="assets/images/logo_perola_rara.png" alt="Logo" class="splash-logo" width="150">
            <p class="splash-slogan">"Onde a arte se encontra com o amor em cada detalhe."</p>
        </div>
    </section>

    <!-- 3. HUB CENTRAL (Menu Principal) -->
    <section id="hub-screen" style="display: none;">
        <header class="hub-header">
            <img src="assets/images/logo_perola_rara.png" alt="Logo" width="120">
            <div class="welcome-text">
                <h1>Painel Administrativo</h1>
                <div class="user-info-card">
                    <span class="user-icon">
                        <!-- Ícone SVG User -->
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle;">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                    </span>
                    <span id="user-email-display">...</span>
                </div>
            </div>
        </header>

        <div class="hub-cards-container">
            <!-- Card Orçamentos -->
            <div class="hub-card" id="btn-go-orcamentos">
                <div class="card-icon">
                    <!-- Ícone SVG Clipboard (Gestão de Pedidos) -->
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.0" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
                        <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
                        <path d="M9 14h6"></path>
                        <path d="M9 10h6"></path>
                        <path d="M9 18h6"></path>
                    </svg>
                </div>
                <h3>Gestão de Pedidos</h3>
                <p>Gerencie clientes, orçamentos e fila de produção.</p>
                <div class="card-footer"><span class="card-action">Acessar &rarr;</span></div>
            </div>

            <!-- Card Precificação -->
            <div class="hub-card" id="btn-go-precificacao">
                <div class="card-icon">
                    <!-- Ícone SVG Tag/Price (Precificação) -->
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.0" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
                        <line x1="7" y1="7" x2="7.01" y2="7"></line>
                    </svg>
                </div>
                <h3>Precificação</h3>
                <p>Calcule custos de materiais e defina preços de venda.</p>
                <div class="card-footer"><span class="card-action">Acessar &rarr;</span></div>
            </div>
        </div>

        <div class="hub-footer-actions">
            <button id="hubLogoutBtn" class="btn-logout-solid">Desconectar</button>
        </div>
        <div id="version-container"></div>
    </section>

    <!-- 4. MÓDULO: ORÇAMENTOS E PEDIDOS -->
    <section id="module-orcamentos" style="display: none;">
        <button class="btn-back-hub">⬅ Voltar ao Menu</button>
        
        <div class="container mobile-container">
            <header class="module-header-styled">
                 <h1 class="module-title-main">Gestão de Pedidos</h1>
                 
                 <nav class="nav-lined">
                    <ul>
                        <li><a href="#" data-pagina="form-orcamento">Novo Orçamento</a></li>
                        <li><a href="#" data-pagina="orcamentos-gerados">Orçamentos Gerados</a></li>
                        <li><a href="#" data-pagina="lista-pedidos">Pedidos Realizados</a></li>
                        <li><a href="#" data-pagina="relatorio">Relatório</a></li>
                    </ul>
                 </nav>
            </header>
            
            <div id="appContent">
                <!-- FORMULÁRIO DE NOVO ORÇAMENTO -->
                <section id="form-orcamento" class="pagina">
                    <h2 class="section-title-lined">Novo Orçamento</h2>
                    <form id="orcamento">
                        <div class="form-row">
                            <div class="form-group"><label>Data:</label><input type="date" id="dataOrcamento"></div>
                            <div class="form-group"><label>Validade:</label><input type="date" id="dataValidade"></div>
                        </div>
                        <div class="form-group"><label>Cliente:</label><input type="text" id="cliente" placeholder="Nome do Cliente"></div>
                        <div class="form-group"><label>Endereço:</label><input type="text" id="endereco"></div>
                        <div class="form-row">
                            <div class="form-group"><label>Cidade:</label><input type="text" id="cidade"></div>
                            <div class="form-group"><label>Telefone:</label><input type="text" id="telefone"></div>
                        </div>
                        <div class="form-group"><label>Email:</label><input type="email" id="clienteEmail"></div>
                        <div class="form-row">
                            <div class="form-group"><label>Tema:</label><input type="text" id="tema"></div>
                            <div class="form-group"><label>Cores:</label><input type="text" id="cores"></div>
                        </div>

                        <h3>Produtos</h3>
                        <div class="table-responsive">
                            <table id="tabelaProdutos">
                                <thead>
                                    <tr>
                                        <th>Qtd</th>
                                        <th>Descrição</th>
                                        <th>Valor Unit.</th>
                                        <th>Total</th>
                                        <th>Ação</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                        <button type="button" id="btnAddProdutoOrcamento">Adicionar Produto</button>

                        <div class="form-row valores-pedido" style="margin-top: 20px;">
                            <div class="form-group"><label>Frete:</label><input type="text" id="valorFrete" placeholder="R$ 0,00"></div>
                            <div class="form-group"><label>Subtotal:</label><input type="text" id="valorOrcamento" readonly></div>
                            <div class="form-group"><label>Total Final:</label><input type="text" id="total" readonly></div>
                        </div>
                        
                        <div class="form-group">
                            <label>Formas de Pagamento:</label>
                            <label><input type="checkbox" name="pagamento" value="Pix"> Pix</label>
                            <label><input type="checkbox" name="pagamento" value="Cartão"> Cartão</label>
                        </div>
                        <div class="form-group"><label>Observações:</label><textarea id="observacoes"></textarea></div>

                        <button type="button" id="btnGerarOrcamento">Gerar Orçamento</button>
                        <button type="button" id="btnAtualizarOrcamento" style="display:none;">Salvar Alterações</button>
                    </form>
                </section>

                <!-- LISTA DE ORÇAMENTOS GERADOS -->
                <section id="orcamentos-gerados" class="pagina" style="display: none;">
                    <h2 class="section-title-lined">Orçamentos Gerados</h2>
                    <button onclick="filtrarOrcamentos()">Atualizar Lista</button>
                    <div class="table-responsive">
                        <table id="tabela-orcamentos">
                            <thead><tr><th>Nº</th><th>Data</th><th>Cliente</th><th>Total</th><th>Pedido?</th><th>Ações</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </section>

                <!-- LISTA DE PEDIDOS REALIZADOS -->
                <section id="lista-pedidos" class="pagina" style="display: none;">
                    <h2 class="section-title-lined">Pedidos Realizados</h2>
                    <button onclick="filtrarPedidos()">Atualizar Lista</button>
                    <div class="table-responsive">
                        <table id="tabela-pedidos">
                            <thead><tr><th>Nº</th><th>Data</th><th>Cliente</th><th>Total</th><th>Ações</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </section>
                
                <!-- FORMULÁRIO DE EDIÇÃO DE PEDIDO -->
                <section id="form-edicao-pedido" class="pagina" style="display: none;">
                    <h2 class="section-title-lined">Editar Pedido</h2>
                    <input type="hidden" id="dataPedidoEdicao">
                    
                    <!-- Dados Básicos -->
                    <div class="form-row">
                        <div class="form-group"><label>Cliente:</label><input type="text" id="clienteEdicao"></div>
                        <div class="form-group"><label>Entrega:</label><input type="date" id="dataEntregaEdicao"></div>
                    </div>
                    <div class="form-group"><label>Endereço:</label><input type="text" id="enderecoEdicao"></div>
                    <div class="form-row">
                        <div class="form-group"><label>Cidade:</label><input type="text" id="cidadeEdicao"></div>
                        <div class="form-group"><label>Telefone:</label><input type="text" id="contatoEdicao"></div>
                    </div>
                    <div class="form-row">
                         <div class="form-group"><label>Tema:</label><input type="text" id="temaEdicao"></div>
                         <div class="form-group"><label>Cores:</label><input type="text" id="coresEdicao"></div>
                    </div>

                    <!-- Tabela de Produtos -->
                    <h3>Produtos</h3>
                    <div class="table-responsive">
                        <table id="tabelaProdutosEdicao">
                            <thead><tr><th>Qtd</th><th>Desc</th><th>Unit</th><th>Total</th><th>Ação</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    <button type="button" id="btnAddProdutoEdicao">Add Produto</button>

                    <!-- Campos Financeiros (Cliente) -->
                    <div class="form-row valores-pedido" style="margin-top: 20px;">
                        <div class="form-group">
                            <label>Frete (R$):</label>
                            <input type="text" id="valorFreteEdicao" placeholder="R$ 0,00" oninput="formatarEntradaMoeda(this)" onblur="atualizarTotaisEdicao()">
                        </div>
                        <div class="form-group">
                            <label>Subtotal Produtos (R$):</label>
                            <input type="text" id="valorPedidoEdicao" placeholder="R$ 0,00" oninput="formatarEntradaMoeda(this)" onblur="atualizarTotaisEdicao()">
                        </div>
                    </div>

                    <!-- Campos Financeiros Gerenciais -->
                    <div class="form-row valores-pedido" style="background-color: #f0f7f7; border: 1px solid #b2d8d8; margin-top: 15px; padding: 15px; border-radius: 10px;">
                        <h3 style="width: 100%; font-size: 1rem; color: #5a8289; margin: 0 0 10px 0;">Demonstrativo Financeiro (Interno)</h3>
                        
                        <div class="form-group">
                            <label title="Soma de Materiais + Custos Indiretos">Custos Totais (R$):</label>
                            <input type="text" id="custoTotalPedido" placeholder="R$ 0,00" oninput="formatarEntradaMoeda(this)">
                        </div>
                        
                        <div class="form-group">
                            <label style="color: #2196F3;">Mão de Obra (R$):</label>
                            <input type="text" id="maoDeObraPedido" placeholder="R$ 0,00" oninput="formatarEntradaMoeda(this)">
                        </div>
                        
                        <div class="form-group">
                            <label style="color: #4CAF50;">Margem de Lucro (R$):</label>
                            <input type="text" id="lucroPedido" placeholder="R$ 0,00" oninput="formatarEntradaMoeda(this)">
                        </div>
                    </div>

                    <!-- Campos de Total e Pagamento -->
                    <div class="form-row valores-pedido" style="margin-top: 15px;">
                        <div class="form-group">
                            <label>Total Geral (R$):</label>
                            <input type="text" id="totalEdicao" readonly>
                        </div>
                        <div class="form-group">
                            <label>Entrada (R$):</label>
                            <input type="text" id="entradaEdicao" placeholder="R$ 0,00" oninput="formatarEntradaMoeda(this)" onblur="atualizarRestanteEdicao()">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Restante (R$):</label>
                        <input type="text" id="restanteEdicao" readonly>
                    </div>

                    <div class="form-group"><label>Observações:</label><textarea id="observacoesEdicao"></textarea></div>

                    <button type="button" id="btnSalvarPedidoEdicao">Salvar Pedido</button>
                </section>

                 <!-- RELATÓRIOS (Atualizado v1.1.0) -->
                 <section id="relatorio" class="pagina" style="display: none;">
                    <h2 class="section-title-lined">Relatório Financeiro Mensal</h2>
                    
                    <!-- Filtros -->
                    <div class="filtro-data" style="display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                        <select id="relatorio-mes">
                            <option value="0">Janeiro</option><option value="1">Fevereiro</option><option value="2">Março</option>
                            <option value="3">Abril</option><option value="4">Maio</option><option value="5">Junho</option>
                            <option value="6">Julho</option><option value="7">Agosto</option><option value="8">Setembro</option>
                            <option value="9">Outubro</option><option value="10">Novembro</option><option value="11">Dezembro</option>
                        </select>
                        <select id="relatorio-ano"></select> <!-- Populado via JS -->
                        <button onclick="gerarRelatorioFinanceiro()">Gerar Relatório</button>
                    </div>

                    <!-- MENSAGEM MOTIVACIONAL (NOVO v1.1.0) -->
                    <div id="mensagem-motivacional" class="feedback-card" style="display: none;"></div>

                    <!-- DASHBOARD KPIS (NOVO v1.1.0) -->
                    <div class="dashboard-resumo" style="display: flex; gap: 15px; flex-wrap: wrap; justify-content: center; margin-bottom: 20px;">
                        <!-- Contador de Vitórias -->
                        <div class="card-kpi card-destaque-qtd">
                            <span>Pedidos Entregues</span>
                            <strong id="kpi-qtd-pedidos">0</strong>
                        </div>
                        <!-- Salário -->
                        <div class="card-kpi kpi-salario">
                            <span>Meu Salário (Mão de Obra)</span>
                            <strong id="kpi-mao-obra">R$ 0,00</strong>
                        </div>
                        <!-- Caixa -->
                        <div class="card-kpi kpi-caixa">
                            <span>Caixa da Empresa</span>
                            <strong id="kpi-lucro">R$ 0,00</strong>
                        </div>
                        <!-- Gastos -->
                        <div class="card-kpi kpi-gastos">
                            <span>Gastos de Produção</span>
                            <strong id="kpi-custos">R$ 0,00</strong>
                        </div>
                        <!-- Total -->
                        <div class="card-kpi kpi-total">
                            <span>Total Vendido</span>
                            <strong id="kpi-total">R$ 0,00</strong>
                        </div>
                    </div>

                    <!-- BARRA VISUAL DE DISTRIBUIÇÃO (NOVO v1.1.0) -->
                    <div class="distribuicao-financeira-container">
                        <h3 style="font-size: 0.9rem; color: #555; margin-bottom: 5px;">Para onde foi o dinheiro?</h3>
                        <div class="barra-empilhada">
                            <div id="barra-custos" class="barra-segmento segmento-vermelho" style="width: 0%"></div>
                            <div id="barra-salario" class="barra-segmento segmento-azul" style="width: 0%"></div>
                            <div id="barra-lucro" class="barra-segmento segmento-verde" style="width: 0%"></div>
                        </div>
                        <div class="legenda-barra">
                            <span class="legenda-item"><span class="dot-red"></span> Gastos</span>
                            <span class="legenda-item"><span class="dot-blue"></span> Salário</span>
                            <span class="legenda-item"><span class="dot-green"></span> Caixa</span>
                        </div>
                    </div>

                    <h3 style="text-align: center; color: #7aa2a9; margin-top: 30px;">Pedidos Entregues</h3>
                    <div class="table-responsive">
                        <table id="tabela-relatorio">
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th class="col-oculta-mobile">Nº Pedido</th> <!-- Oculta no Mobile -->
                                    <th>Cliente</th>
                                    <th style="color: #2196F3;">Salário</th>
                                    <th style="color: #4CAF50;">Caixa</th>
                                    <th style="color: #e53935;">Gastos</th> <!-- Nova Coluna (Vermelho) -->
                                    <th style="color: #ff9800;">Total</th>  <!-- Cor Alterada (Laranja) -->
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    
                    <button onclick="gerarRelatorioXLSX()" style="margin-top: 20px;">Exportar Excel</button>
                 </section>
            </div>
        </div>
    </section>

    <!-- 5. MÓDULO: PRECIFICAÇÃO (ATUALIZADO V1.1.0) -->
    <section id="module-precificacao" style="display: none;">
        <button class="btn-back-hub">⬅ Voltar ao Menu</button>

        <div id="app-container-precificacao" class="mobile-container">
            <header class="module-header-styled">
                 <img src="assets/images/logo_perola_rara.png" class="module-logo-small" alt="Logo">
                 <h1 class="module-title-main">Pérola Rara</h1>
                 
                 <!-- NAVEGAÇÃO ATUALIZADA (TERMINOLOGIA HUMANIZADA) -->
                 <nav class="nav-lined">
                     <ul>
                        <li><a href="#" data-submenu="materiais-insumos" class="nav-link">Materiais</a></li>
                        <li><a href="#" data-submenu="mao-de-obra" class="nav-link">Meu Salário</a></li> <!-- Alterado -->
                        <li><a href="#" data-submenu="custos-indiretos" class="nav-link">Gastos Fixos</a></li> <!-- Alterado -->
                        <li><a href="#" data-submenu="cadastrar-produtos" class="nav-link">Produtos</a></li>
                        <li><a href="#" data-submenu="calculo-precificacao" class="nav-link">Precificação</a></li>
                        <li><a href="#" data-submenu="precificacoes-geradas" class="nav-link">Histórico</a></li>
                    </ul>
                 </nav>
            </header>

            <!-- ABA: MATERIAIS -->
            <div id="materiais-insumos" class="subpagina">
                <h2 class="section-title-lined">Cadastro de Materiais e Insumos</h2>
                <hr class="aviso-separador">
                <p class="aviso-unidades" style="text-align: center; font-size: 0.9em; color: #555;">
                    <strong>Atenção:</strong> Preencha dimensões em <span>cm</span> (Área/Comprimento). Para Litro/Quilo/Unidade, use as unidades padrão (L, kg, un).
                </p>
                <hr class="aviso-separador">
                
                <form id="form-materiais-insumos">
                    <div class="form-group">
                        <label>Nome do Material:</label>
                        <input type="text" id="nome-material">
                    </div>
                    <div class="form-group">
                        <label>Tipo de Material:</label><br>
                        <label><input type="radio" name="tipo-material" value="comprimento" checked> Metro (Comprimento)</label>
                        <label><input type="radio" name="tipo-material" value="litro"> Litro</label>
                        <label><input type="radio" name="tipo-material" value="quilo"> Quilo</label>
                        <label><input type="radio" name="tipo-material" value="unidade"> Unidade</label>
                        <label><input type="radio" name="tipo-material" value="area"> Área (m²)</label>
                    </div>
                    
                    <!-- Campos Dinâmicos -->
                    <div class="form-group" id="campos-comprimento">
                        <label>Comprimento (cm):</label>
                        <input type="number" id="comprimento-cm" step="0.01" value="100">
                    </div>
                    <div class="form-group" id="campos-litro" style="display: none;">
                        <label>Volume (ml):</label>
                        <input type="number" id="volume-ml" step="0.01" value="1000">
                    </div>
                    <div class="form-group" id="campos-quilo" style="display: none;">
                        <label>Peso (g):</label>
                        <input type="number" id="peso-g" step="0.01" value="1000">
                    </div>
                    <div class="form-group" id="campos-area" style="display: none;">
                        <label>Dimensões (cm):</label>
                        <div class="area-inputs" style="display:flex; align-items:center; gap:5px;">
                          <input type="number" id="largura-cm" step="0.01" value="100" placeholder="Largura">
                          <span>x</span>
                          <input type="number" id="altura-cm" step="0.01" value="100" placeholder="Altura">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Valor Total Compra (R$):</label>
                        <input type="number" id="valor-total-material" step="0.01">
                    </div>
                    <button type="button" id="cadastrar-material-insumo-btn">Cadastrar Material</button>
                </form>
                
                <div class="form-group">
                    <input type="text" id="busca-material" placeholder="Filtrar cadastrados..." onkeyup="buscarMateriaisCadastrados()">
                </div>
                
                <div class="table-responsive">
                    <table id="tabela-materiais-insumos" class="tabela-gerada">
                        <thead><tr><th>Nome</th><th>Tipo</th><th>Medida</th><th>Custo Loja</th><th>Custo Unit.</th><th>Ações</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- ABA: MÃO DE OBRA (AGORA: MEU SALÁRIO) -->
            <div id="mao-de-obra" class="subpagina" style="display:none;">
                <h2 class="section-title-lined">Definição do Meu Salário</h2> <!-- Título Humanizado -->
                <form id="form-mao-de-obra">
                    <div class="form-group">
                        <label>Salário a receber (R$):</label>
                        <input type="number" id="salario-receber" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>Horas trabalhadas por mês:</label>
                        <input type="number" id="horas-trabalhadas" value="220">
                    </div>
                    <div class="form-group">
                        <label>Valor da hora (Calculado):</label>
                        <input type="number" id="valor-hora" readonly style="background-color: #cae6e7; font-weight: bold;">
                    </div>
                    
                    <button type="button" id="btn-salvar-mao-de-obra">Salvar Configuração</button>
                    <button type="button" id="btn-editar-mao-de-obra" style="display:none;">Editar</button>

                    <hr class="linha-separadora">
                    
                    <h3>Encargos (Férias e 13º)</h3>
                    <div class="form-group">
                        <label>Incluir encargos?</label>
                        <label><input type="radio" id="incluir-ferias-13o-sim" name="incluir-ferias-13o"> Sim</label>
                        <label><input type="radio" id="incluir-ferias-13o-nao" name="incluir-ferias-13o" checked> Não</label>
                    </div>
                    <div class="form-group">
                        <label>Custo Adicional por Hora (R$):</label>
                        <input type="number" id="custo-ferias-13o" readonly style="background-color: #cae6e7;">
                    </div>
                </form>
            </div>

            <!-- ABA: CUSTOS INDIRETOS (AGORA: GASTOS FIXOS) -->
            <div id="custos-indiretos" class="subpagina" style="display:none;">
                <h2 class="section-title-lined">Gastos Fixos (Indiretos)</h2> <!-- Título Humanizado -->
                <ul id="lista-custos-indiretos">
                    <!-- Preenchido via JS -->
                </ul>
                <button type="button" id="adicionarCustoIndiretoBtn">+ Custo Adicional</button>
                
                <div class="form-group" style="margin-top:20px;">
                    <input type="text" id="busca-custo-indireto" placeholder="Buscar custo..." onkeyup="buscarCustosIndiretosCadastrados()">
                </div>
                <div class="table-responsive">
                    <table id="tabela-custos-indiretos" class="tabela-gerada">
                        <thead><tr><th>Descrição</th><th>Mensal</th><th>Por Hora</th><th>Ação</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- ABA: PRODUTOS -->
            <div id="cadastrar-produtos" class="subpagina" style="display:none;">
                <h2 class="section-title-lined">Montagem de Produtos</h2>
                <form id="form-produtos-cadastrados">
                    <div class="form-group">
                        <label>Nome do Produto:</label>
                        <input type="text" id="nome-produto">
                    </div>
                    
                    <div class="form-group" style="position:relative;">
                        <label>Adicionar Material:</label>
                        <input type="text" id="pesquisa-material" placeholder="Digite para pesquisar...">
                        <div id="resultados-pesquisa" style="display:none; position:absolute; background:white; border:1px solid #ccc; width:100%; max-height:150px; overflow-y:auto; z-index:100;"></div>
                    </div>
                    
                    <div class="table-responsive">
                        <table id="tabela-materiais-produto" class="tabela-gerada">
                            <thead><tr><th>Material</th><th>Tipo</th><th>Custo Unit.</th><th>Dimensões</th><th>Qtd</th><th>Total</th><th>Ação</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    <button type="button" id="cadastrar-produto-btn">Cadastrar Produto</button>
                </form>

                <h2>Produtos Cadastrados</h2>
                <input type="text" id="busca-produto" placeholder="Buscar produto..." onkeyup="buscarProdutosCadastrados()">
                <div class="table-responsive">
                    <table id="tabela-produtos" class="tabela-gerada">
                        <thead><tr><th>Nome</th><th>Itens</th><th>-</th><th>Custo Total</th><th>Ação</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- ABA: CÁLCULO (PRECIFICAÇÃO) -->
            <div id="calculo-precificacao" class="subpagina" style="display:none;">
                <h2 class="section-title-lined">Cálculo da Precificação</h2>

                <div class="pricing-dashboard">
                    <!-- COLUNA 1: ENTRADA DE DADOS -->
                    <div class="pricing-inputs-area">
                        
                        <!-- Painel A: Definição do Produto -->
                        <div class="input-card">
                            <h3>1. Produto & Tempo</h3>
                            <div class="form-group" style="position: relative;">
                                <label>Selecione o Produto:</label>
                                <div class="input-wrapper">
                                    <input type="text" id="produto-pesquisa" placeholder="Busque o produto montado..." autocomplete="off">
                                    <div id="search-spinner" class="spinner hidden"></div>
                                    <span id="aviso-preco-existente" class="badge-aviso hidden"></span>
                                </div>
                                <div id="produto-resultados" class="hidden"></div>
                            </div>

                            <div class="form-row-compact">
                                <div class="form-group" style="width: 100%;">
                                    <label>Horas Gastas:</label>
                                    <input type="number" id="horas-produto" value="1" min="0.1" step="0.1">
                                </div>
                            </div>
                            
                            <!-- Campo oculto para cálculo -->
                            <span id="custo-produto" style="display:none;">0</span> 
                        </div>

                        <!-- Painel B: Definição Financeira -->
                        <div class="input-card">
                            <h3>2. Margem & Taxas</h3>
                            
                            <div class="form-group">
                                <label>Margem de Lucro (%):</label>
                                <div class="input-with-suffix">
                                    <input type="number" id="margem-lucro-final" value="50">
                                    <span>%</span>
                                </div>
                                <p class="help-text">Lucro destinado ao crescimento da empresa.</p>
                            </div>

                            <div class="form-group tax-group">
                                <label>Taxa de Cartão / Maquininha:</label>
                                <div class="tax-controls">
                                    <label class="switch-label">
                                        <input type="radio" id="incluir-taxa-credito-nao" name="taxa" checked> 
                                        Dinheiro/Pix
                                    </label>
                                    <label class="switch-label">
                                        <input type="radio" id="incluir-taxa-credito-sim" name="taxa"> 
                                        Cartão
                                    </label>
                                    <div class="tax-input-wrapper">
                                        <input type="number" id="taxa-credito-percentual" value="6">
                                        <span>%</span>
                                        <button type="button" id="btn-salvar-taxa-credito">Ok</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="action-area">
                            <button type="button" id="btn-gerar-nota" class="btn-primary-large">
                                <!-- SVG Salvar -->
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:8px; vertical-align:text-bottom;">
                                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                                    <polyline points="17 21 17 13 7 13 7 21"></polyline>
                                    <polyline points="7 3 7 8 15 8"></polyline>
                                </svg>
                                Salvar Precificação
                            </button>
                        </div>
                    </div>

                    <!-- COLUNA 2: CARTÃO DE RESULTADO (ATUALIZADO V1.1.0) -->
                    <div class="pricing-results-area">
                        <div class="result-card">
                            <div class="result-header">
                                <h4>Preço de Venda Sugerido</h4>
                                <div class="big-price" id="total-final-com-taxas">R$ 0,00</div>
                            </div>

                            <div class="result-body">
                                <!-- Bloco de Custos -->
                                <div class="result-section costs">
                                    <h5>
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#e53935" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 5px;">
                                            <line x1="12" y1="5" x2="12" y2="19"></line>
                                            <polyline points="19 12 12 19 5 12"></polyline>
                                        </svg>
                                        Custos (Para Pagar Contas)
                                    </h5>
                                    <div class="result-row">
                                        <span>Custos Diretos (Materiais):</span>
                                        <span id="res-custo-mat">R$ 0,00</span>
                                    </div>
                                    <div class="result-row">
                                        <!-- Rótulo Humanizado + Tooltip Educativo -->
                                        <span title="Energia, aluguel, depreciação, etc.">Gastos Fixos:</span>
                                        <span id="custo-indireto">R$ 0,00</span>
                                    </div>
                                    <div class="result-row subtotal-row">
                                        <span class="highlight-red">Subtotal Custos:</span>
                                        <span id="subtotal" class="highlight-red">R$ 0,00</span>
                                    </div>
                                </div>

                                <!-- Bloco de Mão de Obra -->
                                <div class="result-section labor">
                                    <h5>
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#2196F3" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 5px;">
                                            <circle cx="12" cy="12" r="10"></circle>
                                            <polyline points="12 6 12 12 16 14"></polyline>
                                        </svg>
                                        <!-- Rótulo Humanizado -->
                                        Meu Salário (Mão de Obra)
                                    </h5>
                                    <div class="result-row highlight-blue">
                                        <span title="Valor pelo tempo trabalhado na peça">Valor pelo tempo trabalhado:</span>
                                        <span id="total-mao-de-obra">R$ 0,00</span>
                                    </div>
                                    <span id="custo-mao-de-obra-detalhe" style="display:none;"></span>
                                    <span id="custo-ferias-13o-detalhe" style="display:none;"></span>
                                </div>

                                <!-- Bloco de Lucro -->
                                <div class="result-section profit">
                                    <h5>
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#4CAF50" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 5px;">
                                            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                                        </svg>
                                        <!-- Rótulo Humanizado -->
                                        Caixa da Empresa (Crescimento)
                                    </h5>
                                    <div class="result-row highlight-green">
                                        <span title="Valor destinado para reinvestimento e segurança do negócio">Margem Líquida:</span>
                                        <span id="margem-lucro-valor">R$ 0,00</span>
                                    </div>
                                </div>

                                <!-- Bloco de Taxas -->
                                <div class="result-section fees">
                                    <div class="result-row">
                                        <span>Taxas (Cartão/Intermediadores):</span>
                                        <span id="taxa-credito-valor">R$ 0,00</span>
                                    </div>
                                    <div class="result-row total-row-small">
                                        <span>Valor Real (Sem Taxas):</span>
                                        <span id="total-final">R$ 0,00</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="details-container">
                            <details class="details-ci">
                                <summary>Ver Materiais Inclusos</summary>
                                <ul id="lista-materiais-produto" class="small-list"></ul>
                            </details>

                            <details class="details-ci">
                                <summary>Ver detalhe Gastos Fixos</summary> <!-- Humanizado -->
                                <ul id="lista-custos-indiretos-detalhes"></ul>
                            </details>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ABA: HISTÓRICO -->
            <div id="precificacoes-geradas" class="subpagina" style="display:none;">
                <h2 class="section-title-lined">Histórico de Precificações</h2>
                <div class="form-group">
                    <input type="text" id="busca-precificacao" placeholder="Filtrar por produto..." onkeyup="buscarPrecificacoesGeradas()">
                </div>
                <div class="table-responsive">
                    <table id="tabela-precificacoes-geradas" class="tabela-gerada">
                        <thead><tr><th>Nº</th><th>Produto</th><th>Ações</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

        </div>
    </section>

    <!-- 6. MODAL: ASSISTENTE DE CÁLCULO DE CUSTOS (NOVO) -->
    <div id="modal-calculadora-custos" class="modal-overlay" style="display: none;">
        <div class="modal-content calculator-modal">
            <div class="modal-header">
                <h3 id="titulo-calculadora">Assistente de Cálculo</h3>
                <span class="close-modal" onclick="fecharCalculadoraCustos()">&times;</span>
            </div>
            <div class="modal-body">
                <p id="descricao-calculadora" class="calc-description">Preencha os dados abaixo para estimar o custo:</p>
                <form id="form-calculadora-dinamica">
                    <!-- Campos inseridos via JS -->
                </form>
                <div id="resultado-previo-calc" class="calc-result-preview">
                    Estimativa Mensal: <strong>R$ 0,00</strong>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" onclick="fecharCalculadoraCustos()">Cancelar</button>
                <button type="button" class="btn-primary" id="btn-confirmar-calculo">Usar Este Valor</button>
            </div>
        </div>
    </div>

    <!-- SERVICE WORKER -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('./sw.js')
            .then(reg => console.log('SW registrado!'))
            .catch(err => console.log('Falha SW:', err));
        });
      }
    </script>
</body>
</html>
